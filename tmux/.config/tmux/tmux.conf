# =============================================================================
# tmux configuration
# =============================================================================

# ---------------------------------------------------------------------------
# Prefix key
# ---------------------------------------------------------------------------
# Default prefix is C-b, which is awkward to reach. C-a is the classic
# alternative — easy to hit and used by screen veterans.
# To send a literal C-a (go to beginning of line), press C-a twice.
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# ---------------------------------------------------------------------------
# General settings
# ---------------------------------------------------------------------------

# Enable true color and 256 color support
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",alacritty:RGB,xterm-256color:RGB"

# Enable mouse support (scroll, click to select pane, resize panes by dragging)
set -g mouse on

# Start window and pane numbering at 1 (0 is too far from the prefix key)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed (no gaps)
set -g renumber-windows on

# Increase scrollback buffer
set -g history-limit 50000

# Faster escape time (important for vim/neovim users)
set -sg escape-time 0

# Increase display time for messages and pane indicators
set -g display-time 2000
set -g display-panes-time 2000

# Enable focus events (needed for vim autoread)
set -g focus-events on

# Use vi keys in copy mode
setw -g mode-keys vi

# ---------------------------------------------------------------------------
# Keybindings — Window management
# ---------------------------------------------------------------------------

# Create new window (default: prefix + c)
# Switch windows: prefix + number, or prefix + n/p for next/prev

# Shift+Alt+h/l to switch windows without prefix (fast!)
bind -n M-H previous-window
bind -n M-L next-window

# ---------------------------------------------------------------------------
# Keybindings — Pane splitting
# ---------------------------------------------------------------------------
# The defaults (% and ") are impossible to remember.
# Use | for vertical split and - for horizontal split (visual mnemonics).
# Open new panes in the current directory.

unbind '"'
unbind %
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Also bind \ (unshifted |) for convenience
bind \\ split-window -h -c "#{pane_current_path}"

# New windows should also open in the current directory
bind c new-window -c "#{pane_current_path}"

# ---------------------------------------------------------------------------
# Keybindings — Pane navigation (vim-style)
# ---------------------------------------------------------------------------

bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# ---------------------------------------------------------------------------
# Keybindings — Pane resizing
# ---------------------------------------------------------------------------
# Hold prefix, then use H/J/K/L to resize in 5-cell increments

bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# ---------------------------------------------------------------------------
# Keybindings — Copy mode (vi-style)
# ---------------------------------------------------------------------------
# Enter copy mode: prefix + [
# Select text: v (begin selection), y (yank/copy)
# Paste: prefix + ]  or  prefix + p

bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind p paste-buffer

# ---------------------------------------------------------------------------
# Keybindings — Quality of life
# ---------------------------------------------------------------------------

# Easy config reload: prefix + r
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded!"

# Kill pane without confirmation (prefix + x already asks, this skips it)
bind x kill-pane

# Swap windows left/right with Ctrl+Shift+arrow
bind -r "<" swap-window -d -t -1
bind -r ">" swap-window -d -t +1

# ---------------------------------------------------------------------------
# Plugins (managed by tpm)
# ---------------------------------------------------------------------------

# Plugin manager
set -g @plugin 'tmux-plugins/tpm'

# Sensible defaults everyone agrees on
set -g @plugin 'tmux-plugins/tmux-sensible'

# Catppuccin theme
set -g @plugin 'catppuccin/tmux'
set -g @catppuccin_flavor 'mocha'
set -g @catppuccin_window_status_style "rounded"
set -g @catppuccin_status_right_separator ""

# Status bar modules
set -g status-left ""
set -g status-right "#{E:@catppuccin_status_session}"
set -g status-right-length 100

# Persist tmux sessions across reboots
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'on'

# Better search in copy mode
set -g @plugin 'tmux-plugins/tmux-copycat'

# Yank to system clipboard
set -g @plugin 'tmux-plugins/tmux-yank'

# ---------------------------------------------------------------------------
# Initialize tpm (keep this at the very bottom)
# ---------------------------------------------------------------------------
run '~/.config/tmux/plugins/tpm/tpm'
